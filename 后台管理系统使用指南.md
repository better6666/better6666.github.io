# 🔐 后台管理系统使用指南

## 📋 目录
- [系统概述](#系统概述)
- [快速开始](#快速开始)
- [功能详解](#功能详解)
- [安全特性](#安全特性)
- [常见问题](#常见问题)

---

## 🎯 系统概述

这是一个完整的AI模型API密钥管理后台系统，具有以下特点：

### ✨ 核心功能
- 🔒 **安全登录**: 账号密码登录，Session会话管理
- 🔐 **密钥加密**: API密钥使用AES-256加密存储
- 🤖 **多模型支持**: ChatGPT、Claude、Gemini、Grok、Kimi
- 🧪 **连接测试**: 一键测试API连接是否正常
- 📊 **统计监控**: 实时显示配置状态和使用情况
- 📋 **操作日志**: 记录所有管理操作

### 🛡️ 安全保障
- ✅ API密钥加密存储，不以明文保存
- ✅ 登录会话管理，自动过期
- ✅ 密钥不在前端代码中暴露
- ✅ 配置文件添加到.gitignore，不会上传到Git
- ✅ 支持自定义加密密钥

---

## 🚀 快速开始

### 1. 安装依赖

```bash
npm install
```

需要安装的新依赖：
- `express-session` - 会话管理

### 2. 启动服务器

**Windows:**
```bash
start-admin.bat
```

**Mac/Linux:**
```bash
node server-admin.js
```

或使用npm脚本：
```bash
npm run start:admin
```

### 3. 访问后台

启动成功后，浏览器访问：

```
后台管理: http://localhost:3000/admin
聊天界面: http://localhost:3000
```

### 4. 首次登录

**默认账户:**
- 用户名: `admin`
- 密码: `admin123`

⚠️ **重要**: 首次登录后请立即修改密码！

---

## 📖 功能详解

### 1. 登录界面

<img src="https://via.placeholder.com/800x400/667eea/ffffff?text=Login+Page" alt="登录界面">

- 输入用户名和密码
- 点击"登录"按钮
- 登录成功后自动跳转到管理界面

### 2. 管理主界面

#### 2.1 统计卡片

显示三个关键指标：
- **已配置API**: 已经保存的API数量
- **活跃API**: 可用的API数量
- **总请求次数**: API调用统计

#### 2.2 API配置区域

支持配置的AI模型：

**OpenAI (ChatGPT)**
- API Key格式: `sk-...`
- 支持自定义Endpoint（用于第三方代理）
- 模型: GPT-4, GPT-3.5-Turbo等

**Google Gemini**
- API Key格式: `AIza...`
- 官方API: `https://generativelanguage.googleapis.com`
- 模型: Gemini Pro, Gemini Ultra等

**Anthropic Claude**
- API Key格式: `sk-ant-...`
- 官方API: `https://api.anthropic.com`
- 模型: Claude 3 Opus, Sonnet, Haiku等

**xAI Grok**
- API Key格式: `xai-...`
- Elon Musk的AI模型

**Moonshot AI (Kimi)**
- API Key格式: `sk-...`
- 月之暗面的超长上下文模型

#### 2.3 操作按钮

每个API提供商有三个操作：

1. **💾 保存配置**
   - 保存API Key到服务器
   - 自动加密存储
   - 更新状态显示

2. **🧪 测试连接**
   - 验证API Key是否有效
   - 测试网络连接
   - 显示测试结果

3. **🗑️ 删除**
   - 删除已保存的配置
   - 需要确认操作
   - 清除所有相关数据

#### 2.4 操作日志

记录所有管理操作：
- 登录/登出
- 保存配置
- 测试API
- 删除配置

日志格式：
```
[操作描述]
[时间戳]
```

---

## 🔒 安全特性详解

### 1. 密钥加密存储

**加密算法**: AES-256-CBC

**加密过程:**
```javascript
API Key (明文) 
  ↓ 
AES-256加密
  ↓
加密字符串 (存储到文件)
```

**解密过程:**
```javascript
加密字符串 (从文件读取)
  ↓
AES-256解密
  ↓
API Key (明文) → 用于API调用
```

### 2. 存储位置

所有配置文件存储在：
```
.config/
├── api-keys.json      # API密钥（加密）
└── admin-users.json   # 管理员账户（密码哈希）
```

⚠️ 这个目录已添加到`.gitignore`，不会上传到Git仓库

### 3. 会话管理

- 登录后创建Session
- Session有效期: 24小时
- 自动过期清理
- 支持手动登出

### 4. 密码安全

- 密码使用SHA-256哈希存储
- 不存储明文密码
- 支持修改密码（需要实现）

---

## 🎨 使用示例

### 配置OpenAI API

1. 访问 https://platform.openai.com/api-keys
2. 创建新的API Key
3. 复制API Key（格式: sk-...）
4. 在后台管理系统中：
   - 找到"OpenAI (ChatGPT)"卡片
   - 粘贴API Key
   - （可选）修改Endpoint
   - 点击"保存配置"
5. 点击"测试连接"验证
6. 返回聊天界面使用

### 配置Claude API

1. 访问 https://console.anthropic.com/
2. 获取API Key（格式: sk-ant-...）
3. 在后台管理系统中：
   - 找到"Anthropic Claude"卡片
   - 粘贴API Key
   - 点击"保存配置"
4. 测试连接
5. 开始使用

### 配置Gemini API

1. 访问 https://makersuite.google.com/app/apikey
2. 创建API Key（格式: AIza...）
3. 在后台管理系统中配置
4. 测试并使用

---

## 🔧 高级配置

### 自定义加密密钥

在服务器启动前设置环境变量：

**Windows:**
```bash
set ENCRYPTION_KEY=your-64-character-hex-key
node server-admin.js
```

**Mac/Linux:**
```bash
ENCRYPTION_KEY=your-64-character-hex-key node server-admin.js
```

生成安全的加密密钥：
```javascript
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

### 自定义Session密钥

```bash
set SESSION_SECRET=your-random-secret
node server-admin.js
```

### 修改端口

```bash
set PORT=8080
node server-admin.js
```

---

## 📡 API调用流程

### 前端 → 后端 → AI服务

```
用户在聊天界面发送消息
    ↓
POST /api/chat
    ↓
服务器读取加密的API密钥
    ↓
解密API密钥
    ↓
调用对应的AI服务API
    ↓
返回AI回复给用户
```

### 密钥不暴露原理

1. **前端代码中**: 完全不包含任何API密钥
2. **网络传输**: 只传输消息内容，不传输密钥
3. **服务器端**: 密钥仅在服务器内存中短暂存在
4. **存储**: 密钥以加密形式存储在服务器本地

---

## ❓ 常见问题

### Q1: 忘记管理员密码怎么办？

**解决方法:**
1. 停止服务器
2. 删除文件: `.config/admin-users.json`
3. 重启服务器
4. 系统会创建默认账户: admin / admin123
5. 重新登录并修改密码

### Q2: API密钥配置后不生效？

**排查步骤:**
1. 检查API Key格式是否正确
2. 点击"测试连接"验证
3. 查看控制台错误信息
4. 确认API Key有足够的配额
5. 检查网络连接

### Q3: 如何查看加密的API密钥？

**查看方法:**
- 在后台管理界面，点击输入框右侧的👁️图标
- 或直接在输入框中查看（已自动填充）

### Q4: 支持多个管理员账户吗？

**当前版本**: 支持一个管理员账户

**扩展方法**: 修改`.config/admin-users.json`
```json
{
  "admin": {
    "password": "hashed_password",
    "createdAt": "2025-10-06T..."
  },
  "admin2": {
    "password": "hashed_password_2",
    "createdAt": "2025-10-06T..."
  }
}
```

### Q5: 可以在生产环境使用吗？

**建议:**
1. ✅ 修改默认密码
2. ✅ 使用HTTPS（生产环境必须）
3. ✅ 设置强密码策略
4. ✅ 定期备份配置文件
5. ✅ 启用IP白名单（可选）
6. ✅ 使用环境变量管理密钥

### Q6: 如何备份配置？

**备份方法:**
```bash
# 复制整个配置目录
cp -r .config .config.backup

# 或只备份API密钥
cp .config/api-keys.json api-keys.backup.json
```

### Q7: 配置文件位置在哪？

```
项目根目录/
└── .config/
    ├── api-keys.json      # API密钥（加密）
    └── admin-users.json   # 管理员账户
```

### Q8: 如何添加新的AI提供商？

**步骤:**
1. 在`admin.html`中添加对应的UI卡片
2. 在`server-admin.js`中添加处理函数
3. 实现API调用逻辑
4. 测试功能

---

## 🔐 安全建议

### 生产环境部署

1. **使用HTTPS**
   ```javascript
   // 使用Let's Encrypt等工具获取SSL证书
   const https = require('https');
   const fs = require('fs');
   
   const options = {
     key: fs.readFileSync('private-key.pem'),
     cert: fs.readFileSync('certificate.pem')
   };
   
   https.createServer(options, app).listen(443);
   ```

2. **设置强密码**
   - 至少12位
   - 包含大小写字母、数字、符号
   - 定期更换

3. **限制访问**
   - 只允许特定IP访问后台
   - 使用防火墙规则
   - 启用速率限制

4. **定期备份**
   - 每天备份配置文件
   - 使用版本控制
   - 异地备份

5. **监控日志**
   - 记录所有登录尝试
   - 警报异常操作
   - 定期审计

---

## 📊 系统架构

```
┌─────────────────┐
│   用户浏览器     │
└────────┬────────┘
         │ HTTPS
         ↓
┌─────────────────┐
│  Express服务器   │
│  ┌───────────┐  │
│  │ Session   │  │
│  │ 管理      │  │
│  └───────────┘  │
│  ┌───────────┐  │
│  │ API密钥   │  │
│  │ 加解密    │  │
│  └───────────┘  │
└────────┬────────┘
         │
         ↓
┌─────────────────┐
│  .config/       │
│  (加密存储)      │
└─────────────────┘
         │
         ↓
┌─────────────────┐
│  AI服务API      │
│  (OpenAI,       │
│   Claude等)     │
└─────────────────┘
```

---

## 📞 技术支持

### 日志查看

**服务器日志:**
- 查看控制台输出
- 记录所有API调用
- 显示错误信息

**操作日志:**
- 后台管理界面底部
- 记录管理操作
- 包含时间戳

### 调试模式

启用详细日志：
```bash
set DEBUG=* 
node server-admin.js
```

---

## 🎓 最佳实践

1. **定期更新密码**: 每3个月更换一次
2. **监控API使用**: 避免超出配额
3. **备份配置**: 每周备份一次
4. **测试连接**: 配置后立即测试
5. **查看日志**: 定期检查操作日志
6. **更新依赖**: 保持npm包最新

---

## 🚀 更新日志

### v1.0.0 (2025-10-06)
- ✅ 完整的后台管理系统
- ✅ 安全登录功能
- ✅ API密钥加密存储
- ✅ 多模型支持
- ✅ 连接测试功能
- ✅ 操作日志记录

---

## 📝 许可证

MIT License

---

**祝您使用愉快！** 🎉

