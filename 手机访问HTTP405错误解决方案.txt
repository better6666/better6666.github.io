📱 手机访问 HTTP 405 错误解决方案

========================================
问题：手机端显示"发送失败，http 405"
========================================

HTTP 405 = Method Not Allowed（方法不被允许）

========================================
✅ 解决步骤
========================================

步骤1：使用正确的URL
-------------------------

❌ 错误：https://xxxxx.loca.lt
✅ 正确：https://xxxxx.loca.lt/chat.html

**必须包含 /chat.html**

步骤2：获取最新的公网地址
-------------------------

每次重启 Localtunnel 都会生成新地址。

在电脑命令行查看输出：
your url is: https://xxxxx.loca.lt

复制完整地址，加上 /chat.html

步骤3：首次访问处理
-------------------------

第一次访问可能显示：
"Tunnel Password" 或 "Click to Continue"

✅ 点击"Click to Continue"按钮
✅ 然后才能看到聊天界面

步骤4：选择正确的模型
-------------------------

✅ 选择：🌙 Kimi AI
❌ 不要选：Sonnet 4.5（会崩溃）

步骤5：测试发送消息
-------------------------

输入："你好"
点击发送

✅ 如果成功：应该看到回复
❌ 如果失败：查看下面的诊断步骤

========================================
🔧 已修复的问题
========================================

✅ 已优化 CORS 配置
✅ 已添加请求日志
✅ 服务器已重启

新的改进：
- 允许所有来源访问
- 支持所有必要的HTTP方法
- 添加详细的请求日志（在服务器端查看）

========================================
📊 诊断步骤
========================================

如果仍然出现 HTTP 405 错误：

1. 确认URL正确
   - 必须有 /chat.html
   - 例如：https://xxxxx.loca.lt/chat.html

2. 检查Localtunnel状态
   - 电脑命令行应该显示："your url is: ..."
   - 如果没有，重新运行：lt --port 3000

3. 查看服务器日志
   - 电脑命令行会显示所有请求
   - 格式：2025-01-04T12:00:00.000Z POST /api/chat/stream
   - 如果没有日志，说明请求没到达服务器

4. 尝试电脑浏览器
   - 先在电脑上测试：http://localhost:3000/chat.html
   - 如果电脑可以，手机不行，可能是网络问题

5. 清除手机浏览器缓存
   - 手机浏览器 → 设置 → 清除缓存
   - 重新访问

========================================
🌐 完整测试流程
========================================

电脑端：
1. 运行：node server-multi-ai.js
2. 运行：lt --port 3000
3. 看到：your url is: https://xxxxx.loca.lt
4. 记下这个地址

手机端：
1. 打开浏览器
2. 访问：https://xxxxx.loca.lt/chat.html
3. 如果看到密码页面，点击"Click to Continue"
4. 看到聊天界面
5. 选择：🌙 Kimi AI
6. 发送："你好"
7. ✅ 应该收到回复

========================================
❓ 常见错误
========================================

错误1：访问 https://xxxxx.loca.lt（没有 /chat.html）
解决：加上 /chat.html

错误2：使用了旧的地址
解决：每次重启都要用新地址

错误3：选择了 Sonnet 4.5
解决：改选 🌙 Kimi AI

错误4：Localtunnel 没启动
解决：运行 lt --port 3000

错误5：服务器崩溃
解决：重启服务器（node server-multi-ai.js）

========================================
💡 提示
========================================

如果手机端仍然无法访问，可以尝试：

方案A：使用 Cpolar（国内更快）
- 下载：https://www.cpolar.com/
- 配置 http 3000
- 获得国内公网地址

方案B：部署到 Vercel
- 固定域名
- 全球访问
- 24小时在线

方案C：检查手机网络
- 确保手机能访问国际网站
- 尝试用4G/5G代替WiFi
- 或用VPN

========================================
📞 获取帮助
========================================

如果问题持续，请提供：
1. 手机浏览器访问的完整URL
2. 手机浏览器显示的错误截图
3. 电脑命令行的服务器日志

这样可以更好地诊断问题！

========================================

