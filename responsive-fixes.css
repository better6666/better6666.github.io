/* ========================================
   响应式布局优化补丁
   针对手机端和电脑端的显示问题
   ======================================== */

/* ========== 全局基础优化 ========== */
* {
    -webkit-tap-highlight-color: transparent;
}

html {
    -webkit-text-size-adjust: 100%;
    -moz-text-size-adjust: 100%;
    -ms-text-size-adjust: 100%;
    text-size-adjust: 100%;
}

body {
    overscroll-behavior-y: none;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* ========== 桌面端侧边栏隐藏修复 ========== */
@media (min-width: 768px) {
    /* 侧边栏隐藏时，主内容区域扩展到全宽 */
    .sidebar.hidden ~ .main-content {
        margin-left: 0 !important;
        width: 100% !important;
    }
    
    /* 确保body使用flex布局 */
    body {
        display: flex;
        flex-direction: row;
    }
    
    /* 主内容区域flex自适应 */
    .main-content {
        flex: 1;
        min-width: 0;
    }
    
    /* 侧边栏隐藏动画 */
    .sidebar {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .sidebar.hidden {
        margin-left: -260px;
        width: 0;
        overflow: hidden;
        flex-shrink: 0;
        flex-basis: 0;
    }
    
    /* 侧边栏隐藏时，聊天容器居中显示 */
    .sidebar.hidden ~ .main-content .chat-container {
        padding-left: 2rem;
        padding-right: 2rem;
    }
    
    /* 侧边栏隐藏时，输入框居中 */
    .sidebar.hidden ~ .main-content .input-section {
        margin: 0 auto;
    }
    
    /* 切换按钮位置调整 */
    .sidebar.hidden ~ .main-content .toggle-sidebar-btn {
        left: 1rem;
    }
}

/* ========== 移动端优化（手机） ========== */
@media (max-width: 767px) {
    /* 基础字体 - 16px 防止iOS自动缩放 */
    html {
        font-size: 16px !important;
    }
    
    body {
        font-size: 1rem;
        line-height: 1.5;
        overflow-x: hidden;
    }
    
    /* 侧边栏 - 抽屉式设计 */
    .sidebar {
        position: fixed !important;
        z-index: 100 !important;
        height: 100vh !important;
        width: 280px !important;
        max-width: 85vw !important;
        left: 0 !important;
        top: 0 !important;
        transform: translateX(-100%) !important;
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        margin-left: 0 !important;
        box-shadow: 2px 0 12px rgba(0, 0, 0, 0.15);
    }
    
    .sidebar.mobile-visible {
        transform: translateX(0) !important;
    }
    
    /* 遮罩层 */
    .sidebar-backdrop {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 99;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .sidebar-backdrop.active {
        display: block;
        opacity: 1;
    }
    
    /* 主内容区 - 全宽显示 */
    .main-content {
        width: 100% !important;
        margin-left: 0 !important;
        max-width: 100% !important;
        flex: 1 !important;
    }
    
    /* 切换侧边栏按钮 - 触摸友好 */
    .toggle-sidebar-btn {
        display: flex !important;
        position: fixed !important;
        top: 0.75rem;
        left: 0.75rem;
        width: 44px !important;
        height: 44px !important;
        min-width: 44px !important;
        min-height: 44px !important;
        z-index: 50;
        border-radius: 0.5rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    /* 聊天容器 */
    .chat-container {
        padding-top: 4rem !important; /* 为顶部按钮留空间 */
        padding-bottom: calc(env(safe-area-inset-bottom) + 0.5rem);
    }
    
    /* 欢迎界面 */
    .welcome-section {
        padding: 1.5rem 1rem !important;
        gap: 1.5rem !important;
    }
    
    .welcome-title {
        font-size: 1.75rem !important;
        line-height: 1.2 !important;
    }
    
    .upgrade-badge {
        font-size: 0.875rem !important;
        padding: 0.5rem 0.875rem !important;
    }
    
    /* 消息区域 */
    .messages-container {
        padding: 1rem 1rem !important;
        max-width: 100% !important;
    }
    
    .message-bubble {
        padding: 0.875rem 1rem !important;
        max-width: 100% !important;
    }
    
    .message-text-content {
        font-size: 1rem !important;
        line-height: 1.6 !important;
    }
    
    .message-text-content h1 {
        font-size: 1.5rem !important;
        margin: 1rem 0 0.75rem !important;
    }
    
    .message-text-content h2 {
        font-size: 1.25rem !important;
        margin: 0.875rem 0 0.625rem !important;
    }
    
    .message-text-content h3 {
        font-size: 1.125rem !important;
        margin: 0.75rem 0 0.5rem !important;
    }
    
    .message-text-content p {
        margin: 0.75rem 0 !important;
    }
    
    .message-text-content pre {
        font-size: 0.875rem !important;
        padding: 0.875rem !important;
        margin: 0.75rem 0 !important;
        overflow-x: auto !important;
    }
    
    .message-text-content code {
        font-size: 0.875rem !important;
    }
    
    /* 输入区域 - 优化布局 */
    .input-section {
        width: 100% !important;
        max-width: 100% !important;
        padding: 0.75rem !important;
        padding-bottom: calc(env(safe-area-inset-bottom) + 0.75rem) !important;
        margin: 0 !important;
    }
    
    .input-wrapper {
        padding: 0.625rem 0.75rem !important;
        border-radius: 1.5rem !important;
        gap: 0.5rem !important;
    }
    
    .input-textarea {
        font-size: 16px !important; /* 16px 防止iOS自动缩放 */
        line-height: 1.5 !important;
        min-height: 44px !important;
        max-height: 160px !important;
        padding: 0.625rem 0.5rem !important;
    }
    
    .input-actions {
        gap: 0.5rem !important;
        padding: 0 !important;
        flex-shrink: 0;
    }
    
    /* 所有按钮 - 符合触摸标准（44x44px） */
    .attach-btn,
    .image-btn,
    .tool-btn,
    .send-btn {
        width: 44px !important;
        height: 44px !important;
        min-width: 44px !important;
        min-height: 44px !important;
        padding: 0 !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
    }
    
    .attach-btn svg,
    .image-btn svg,
    .tool-btn svg,
    .send-btn svg {
        width: 20px !important;
        height: 20px !important;
    }
    
    /* 快捷操作按钮 */
    .quick-actions {
        flex-direction: column !important;
        gap: 0.5rem !important;
        width: 100% !important;
    }
    
    .quick-action-btn {
        width: 100% !important;
        padding: 0.75rem 1rem !important;
        justify-content: flex-start !important;
        min-height: 48px !important;
        font-size: 0.9375rem !important;
    }
    
    /* 模型选择器 */
    .model-dropdown-btn {
        padding: 0.5rem 0.75rem !important;
        font-size: 0.875rem !important;
        min-height: 44px !important;
    }
    
    .model-dropdown {
        width: 100% !important;
        max-width: calc(100vw - 2rem) !important;
        left: 1rem !important;
        right: 1rem !important;
        max-height: 60vh !important;
    }
    
    .model-option {
        padding: 0.875rem 1rem !important;
        min-height: 56px !important;
    }
    
    .model-name {
        font-size: 0.9375rem !important;
    }
    
    .model-description {
        font-size: 0.8125rem !important;
        line-height: 1.4 !important;
    }
    
    /* 消息操作按钮 */
    .message-action-btn {
        width: 44px !important;
        height: 44px !important;
        min-width: 44px !important;
        min-height: 44px !important;
    }
    
    .message-action-btn svg {
        width: 18px !important;
        height: 18px !important;
    }
    
    /* Artifacts面板 - 全屏显示 */
    .artifacts-panel {
        width: 100% !important;
        min-width: 100% !important;
        max-width: 100% !important;
        z-index: 201 !important;
    }
    
    .artifacts-header {
        padding: 1rem !important;
    }
    
    .artifacts-title {
        font-size: 1rem !important;
    }
    
    .artifacts-action-btn {
        min-height: 44px !important;
        padding: 0.625rem 1rem !important;
        font-size: 0.9375rem !important;
    }
    
    /* 文件附件卡片 */
    .file-attachments-container {
        flex-direction: column !important;
        padding: 0.5rem 1rem !important;
    }
    
    .file-card {
        max-width: 100% !important;
        width: 100% !important;
    }
    
    /* 侧边栏内容 */
    .sidebar-header {
        padding: 1rem !important;
    }
    
    .logo-section {
        padding: 0.5rem 0.5rem 0.75rem !important;
    }
    
    .logo-text {
        font-size: 1.125rem !important;
    }
    
    .new-chat-btn {
        padding: 0.75rem 1rem !important;
        min-height: 48px !important;
        font-size: 0.9375rem !important;
    }
    
    .sidebar-nav {
        padding: 0.75rem !important;
    }
    
    .nav-item {
        padding: 0.75rem 1rem !important;
        min-height: 48px !important;
        font-size: 0.9375rem !important;
    }
    
    .recent-item {
        padding: 0.625rem 1rem !important;
        min-height: 44px !important;
        font-size: 0.9375rem !important;
    }
    
    .sidebar-footer {
        padding: 1rem !important;
    }
    
    .user-info {
        padding: 0.75rem 0.5rem !important;
        min-height: 56px !important;
    }
    
    .user-avatar {
        width: 2.5rem !important;
        height: 2.5rem !important;
        font-size: 1rem !important;
    }
    
    .user-name {
        font-size: 0.9375rem !important;
    }
    
    .user-plan {
        font-size: 0.8125rem !important;
    }
    
    /* 用户菜单 */
    .user-menu-dropdown {
        width: calc(100vw - 2rem) !important;
        max-width: 320px !important;
        left: 1rem !important;
        max-height: 70vh !important;
    }
    
    .user-menu-item {
        padding: 0.875rem 1rem !important;
        min-height: 52px !important;
        font-size: 0.9375rem !important;
    }
}

/* ========== 小屏手机（iPhone SE 等） ========== */
@media (max-width: 375px) {
    .sidebar {
        width: 90vw !important;
    }
    
    .welcome-title {
        font-size: 1.5rem !important;
    }
    
    .user-menu-dropdown {
        width: calc(100vw - 1.5rem) !important;
        left: 0.75rem !important;
    }
}

/* ========== 横屏模式优化 ========== */
@media (max-height: 500px) and (orientation: landscape) and (max-width: 767px) {
    .welcome-section {
        padding: 1rem !important;
        gap: 1rem !important;
    }
    
    .welcome-title {
        font-size: 1.25rem !important;
    }
    
    .quick-actions {
        flex-direction: row !important;
        flex-wrap: wrap !important;
    }
    
    .quick-action-btn {
        width: calc(50% - 0.25rem) !important;
        min-height: 44px !important;
    }
    
    .messages-container {
        padding: 0.75rem 1rem !important;
    }
    
    .input-section {
        padding: 0.5rem 0.75rem !important;
        padding-bottom: calc(env(safe-area-inset-bottom) + 0.5rem) !important;
    }
}

/* ========== 平板端（iPad 等） ========== */
@media (min-width: 768px) and (max-width: 1023px) {
    html {
        font-size: 16px;
    }
    
    .sidebar {
        width: 260px;
        position: relative;
        transform: translateX(0) !important;
    }
    
    .sidebar-backdrop {
        display: none !important;
    }
    
    .toggle-sidebar-btn {
        display: flex;
        position: absolute;
    }
    
    .chat-container {
        padding-top: 1rem;
    }
    
    .input-section {
        max-width: 720px;
        padding: 1rem 2rem;
    }
    
    .messages-container {
        max-width: 720px;
        padding: 2rem;
    }
}

/* ========== 笔记本电脑 ========== */
@media (min-width: 1024px) and (max-width: 1439px) {
    html {
        font-size: 16px;
    }
    
    .input-section {
        max-width: 800px;
        padding: 1rem 2.5rem 2rem;
    }
    
    .messages-container {
        max-width: 800px;
        padding: 2rem 2.5rem;
    }
}

/* ========== 大屏电脑 ========== */
@media (min-width: 1440px) {
    html {
        font-size: 16px;
    }
    
    .input-section {
        max-width: 900px;
        padding: 1rem 3rem 2rem;
    }
    
    .messages-container {
        max-width: 900px;
        padding: 2.5rem 3rem;
    }
}

/* ========== 超大屏幕 ========== */
@media (min-width: 1920px) {
    .input-section {
        max-width: 1000px;
    }
    
    .messages-container {
        max-width: 1000px;
    }
}

/* ========== Config页面优化 ========== */
@media (max-width: 767px) {
    .config-container {
        padding: 1.5rem !important;
        margin: 0 !important;
        border-radius: 0 !important;
        min-height: 100vh;
    }
    
    .config-container h1 {
        font-size: 1.5rem !important;
    }
    
    .tabs {
        flex-wrap: nowrap;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
    }
    
    .tabs::-webkit-scrollbar {
        display: none;
    }
    
    .tab {
        flex-shrink: 0;
        padding: 0.625rem 1rem !important;
        font-size: 0.9375rem !important;
    }
    
    .ai-provider {
        padding: 1rem !important;
        margin-bottom: 1rem !important;
    }
    
    .provider-logo {
        width: 2.5rem !important;
        height: 2.5rem !important;
        font-size: 1.25rem !important;
    }
    
    .provider-name {
        font-size: 1.125rem !important;
    }
    
    .provider-description {
        font-size: 0.8125rem !important;
    }
    
    .form-group {
        margin-bottom: 0.875rem !important;
    }
    
    .form-group label {
        font-size: 0.9375rem !important;
    }
    
    .form-group input,
    .form-group select {
        padding: 0.75rem !important;
        font-size: 16px !important; /* 防止iOS缩放 */
    }
    
    .btn {
        padding: 0.75rem 1.25rem !important;
        font-size: 0.9375rem !important;
        min-height: 48px !important;
    }
    
    .actions {
        flex-direction: column !important;
        gap: 0.75rem !important;
    }
    
    .actions .btn {
        width: 100% !important;
    }
    
    .toggle-switch {
        width: 3rem !important;
        height: 1.75rem !important;
    }
    
    .toggle-switch::before {
        width: 1.25rem !important;
        height: 1.25rem !important;
    }
    
    .toggle-switch.active::before {
        transform: translateX(1.25rem) !important;
    }
}

/* ========== Index页面优化 ========== */
@media (max-width: 767px) {
    .container {
        padding: 0;
    }
    
    .logo-container {
        padding-top: 2rem !important;
    }
    
    .main-content {
        padding: 0 1rem !important;
    }
    
    .form-wrapper {
        max-width: 100% !important;
    }
    
    .checkbox-container {
        padding: 1rem !important;
    }
    
    .checkbox-wrapper {
        gap: 0.875rem !important;
    }
    
    .checkbox-text {
        font-size: 0.9375rem !important;
        line-height: 1.5 !important;
    }
    
    .submit-button {
        height: 3rem !important;
        font-size: 1rem !important;
    }
    
    footer {
        padding-bottom: calc(env(safe-area-inset-bottom) + 2rem);
        font-size: 0.8125rem !important;
    }
}

/* ========== 通用工具类 ========== */
.touch-target {
    min-width: 44px !important;
    min-height: 44px !important;
}

.safe-area-bottom {
    padding-bottom: env(safe-area-inset-bottom);
}

.safe-area-top {
    padding-top: env(safe-area-inset-top);
}

.no-zoom {
    touch-action: manipulation;
}

/* ========== 滚动优化 ========== */
.smooth-scroll {
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
}

/* ========== 防止内容被键盘遮挡 ========== */
@supports (-webkit-touch-callout: none) {
    .input-section {
        position: relative;
        padding-bottom: calc(env(safe-area-inset-bottom) + 1rem);
    }
}

/* ==================== 基于设备类型的智能优化 ==================== */

/* 手机端特定优化 */
body[data-device-type="mobile"] {
    font-size: 16px; /* 防止iOS自动缩放 */
}

body[data-device-type="mobile"] .artifacts-panel {
    /* 手机端Artifacts面板全屏显示 */
    width: 100% !important;
    min-width: 100% !important;
    max-width: 100% !important;
}

body[data-device-type="mobile"] .artifacts-panel.active ~ .main-content {
    /* 手机端打开Artifacts时隐藏主内容 */
    display: none !important;
}

/* 平板端特定优化 */
body[data-device-type="tablet"] .artifacts-panel {
    /* 平板端Artifacts面板占50% */
    width: 50% !important;
    min-width: 400px !important;
    max-width: 600px !important;
}

body[data-device-type="tablet"] .main-content.with-artifacts {
    margin-right: 50% !important;
}

body[data-device-type="tablet"] .sidebar {
    width: 260px;
}

/* 桌面端特定优化 */
body[data-device-type="desktop"] .artifacts-panel {
    width: 36%;
    min-width: 450px;
    max-width: 600px;
}

/* iOS特定优化 */
body[data-os="ios"] {
    /* iOS平滑滚动 */
    -webkit-overflow-scrolling: touch;
}

body[data-os="ios"] input,
body[data-os="ios"] textarea {
    /* iOS输入框优化 */
    font-size: 16px !important; /* 防止缩放 */
    border-radius: 0;
    -webkit-appearance: none;
}

body[data-os="ios"] .input-section {
    /* iOS键盘适配 */
    padding-bottom: calc(env(safe-area-inset-bottom) + 1rem);
}

/* Android特定优化 */
body[data-os="android"] {
    /* Android渲染优化 */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

body[data-os="android"] .input-section {
    /* Android键盘适配 */
    padding-bottom: 1rem;
}

/* 触摸设备优化 */
body[data-touch="true"] button,
body[data-touch="true"] .btn,
body[data-touch="true"] .clickable {
    /* 触摸设备增大点击区域 */
    min-width: 44px !important;
    min-height: 44px !important;
}

body[data-touch="true"] {
    /* 禁用触摸高亮 */
    -webkit-tap-highlight-color: transparent;
}

/* Safari特定优化 */
body[data-browser="safari"] {
    /* Safari渲染优化 */
    -webkit-font-smoothing: antialiased;
}

body[data-browser="safari"] input,
body[data-browser="safari"] textarea {
    /* Safari输入框样式修复 */
    -webkit-appearance: none;
    appearance: none;
}

/* Chrome特定优化 */
body[data-browser="chrome"] {
    /* Chrome滚动优化 */
    scroll-behavior: smooth;
}

/* Firefox特定优化 */
body[data-browser="firefox"] {
    /* Firefox滚动优化 */
    scrollbar-width: thin;
    scrollbar-color: #d4d4d4 transparent;
}

/* ==================== 响应式断点优化（基于实际设备尺寸） ==================== */

/* 超小手机 (iPhone SE, iPhone 5) */
@media (max-width: 374px) {
    body[data-device-type="mobile"] .welcome-title {
        font-size: 1.375rem !important;
    }
    
    body[data-device-type="mobile"] .sidebar {
        width: 95vw !important;
    }
}

/* 标准手机 (iPhone 6/7/8, most Android) */
@media (min-width: 375px) and (max-width: 413px) {
    body[data-device-type="mobile"] .message-text-content {
        font-size: 1rem !important;
    }
}

/* 大屏手机 (iPhone Plus, Pixel XL) */
@media (min-width: 414px) and (max-width: 767px) {
    body[data-device-type="mobile"] .message-text-content {
        font-size: 1.0625rem !important;
    }
    
    body[data-device-type="mobile"] .input-textarea {
        font-size: 16px !important;
    }
}

/* 小平板 (iPad Mini) */
@media (min-width: 768px) and (max-width: 820px) {
    body[data-device-type="tablet"] .messages-container {
        max-width: 640px !important;
    }
}

/* 标准平板 (iPad) */
@media (min-width: 821px) and (max-width: 1023px) {
    body[data-device-type="tablet"] .messages-container {
        max-width: 720px !important;
    }
}

/* 大平板 (iPad Pro 11") */
@media (min-width: 1024px) and (max-width: 1193px) {
    body[data-device-type="tablet"] .messages-container {
        max-width: 800px !important;
    }
}

/* 超大平板 (iPad Pro 12.9") */
@media (min-width: 1194px) {
    body[data-device-type="tablet"] .messages-container {
        max-width: 900px !important;
    }
}

/* ==================== 横屏模式特殊处理 ==================== */

/* 手机横屏 */
@media (orientation: landscape) and (max-width: 896px) and (max-height: 414px) {
    body[data-device-type="mobile"] .welcome-section {
        padding: 0.75rem 1rem !important;
        gap: 0.75rem !important;
    }
    
    body[data-device-type="mobile"] .welcome-title {
        font-size: 1.25rem !important;
    }
    
    body[data-device-type="mobile"] .input-section {
        padding: 0.5rem 1rem !important;
    }
    
    body[data-device-type="mobile"] .chat-container {
        padding-top: 3rem !important;
    }
}

/* 平板横屏 */
@media (orientation: landscape) and (min-width: 768px) and (max-width: 1366px) {
    body[data-device-type="tablet"] .sidebar {
        width: 240px;
    }
    
    body[data-device-type="tablet"] .artifacts-panel {
        width: 45% !important;
    }
    
    body[data-device-type="tablet"] .main-content.with-artifacts {
        margin-right: 45% !important;
    }
}

/* ==================== 高像素密度屏幕优化 ==================== */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    body {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
    
    .message-text-content {
        text-rendering: optimizeLegibility;
    }
}

/* ==================== 暗色模式支持（预留） ==================== */
@media (prefers-color-scheme: dark) {
    /* 未来可以在这里添加暗色模式样式 */
}

/* ==================== 减少动画偏好 ==================== */
@media (prefers-reduced-motion: reduce) {
    * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* ==================== 打印优化 ==================== */
@media print {
    .sidebar,
    .toggle-sidebar-btn,
    .input-section,
    .artifacts-notification-btn {
        display: none !important;
    }
    
    .main-content {
        width: 100% !important;
        margin: 0 !important;
    }
    
    .message-bubble {
        page-break-inside: avoid;
    }
}

